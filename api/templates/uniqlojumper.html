<!DOCTYPE html>
<html>
<head>
    <title>{{ item_name }}</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/main.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" >
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    {% include 'navbar.html' %} 
    <div class="container">
        <div class="row">
            <!-- Image Column -->
            <div class="col-md-6">
                <img src="{{ url }}" alt="{{ item_name }}" class="img-responsive">
            </div>

            <!-- Information Column -->
            <div class="col-md-6">
                <h2>{{ item_name }}</h2>
                <p class="price">£{{ price }}</p>
                <select id="currency-selector">
                    <option value="USD">USD</option>
                    <option value="EUR">EUR</option>
                    <option value="GBP">GBP</option>
                </select>
                
                <div id="product-price">Price: $<span id="price">{{
                price }}</span></div>
                <!-- Additional product details -->
                <p>Description of {{ item_name }}...</p>

                <!-- Checkout Options -->
                <div>
                    <label for="size">Size:</label>
                    <select id="size" name="size">
                        <option value="S" >Small</option>
                        <option value="M" >Medium</option>
                        <option value="L" >Large</option>
                    </select>
                </div>
                <div>
                    <label for="quantity">Quantity:</label>
                    <input type="number" id="quantity" name="quantity" min="1" max="{{ stock }}">
                </div>
                <button type="button" class="btn btn-primary">Add to Cart</button>
                <button type="button" class="btn btn-success">Buy Now</button>
            </div>
        </div>
    </div>
    {% include 'footer.html' %}
    <script>
        function updatePriceDisplay(price, currencySymbol) {
            document.getElementById('price').innerText = price.toFixed(2);
            document.getElementById('currency-symbol').innerText = currencySymbol;
        }
        
        document.querySelector('.btn-primary').addEventListener('click', function(){
            var itemName = '{{ item_name }}'
            var price = '{{ price }}'
            var sizeSelect = document.getElementById('size');
            var size = sizeSelect.options[sizeSelect.selectedIndex].value;
            var quantity = document.getElementById('quantity').value;
            addToCart(itemName, price, size, quantity);
        });

        function addToCart(itemName, price, size, quantity){
            var data = { itemName: itemName, price: price, size: size, quantity: quantity };
            
            fetch('/add-to-cart', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
            .then(response => response.json())
            .then(data => {
                if(data.success){
                    window.location.href = '/basket';
                }
                else {
                    console.error('Error adding item to cart');
                }
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        }
        
        document.getElementById('currency-selector').addEventListener('change', function() {
            var selectedCurrency = this.value;
            var originalPrice = 12.00;
        
            fetch('/convert_currency?price=' + originalPrice + '&currency=' + selectedCurrency)
                .then(response => response.json())
                .then(data => {
                    var currencySymbols = { 'USD': '$', 'EUR': 'x', 'GBP': '£' };
                    var symbol = currencySymbols[selectedCurrency] || '£';
                    updatePriceDisplay(data.convertedPrice, symbol);
                })
                .catch(error => console.error('Error:', error));
            });
        
            window.onload = function() {
                document.getElementById('currency-selector').dispatchEvent(new Event('change'));
            };
    </script>
</body>
</html>
